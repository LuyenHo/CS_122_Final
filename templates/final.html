<!DOCTYPE html>
<html>

<head>
    <title>Wildfires</title>
    <meta name="description">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-x6xWoaPhx1qbg9xkaXa6Pbmcz6M7xvxH3rtB/51fy9+xJk2F+a36bRtBpzUgk5xZbhJ+2MxKPspwoiK9UuFKeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            background-color: #999999;
            margin: 0;
        }
        /*Content Body */
        /* Center the map image */
        .centered-map {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* Additional styles for the image */
        .centered-map img {
            max-width: 100%;
            max-height: 70vh;
        }
    </style>
</head>

<body>
    {{ chart_html | safe }}
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Wildfires</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Dropdown
                    </a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" href="#" onclick="showMapPopup()">Interactive Fire Map</a>
                        <a class="dropdown-item" href="#" onclick="showCountiesPlot()">Counties Affected</a>
                        <a class="dropdown-item" href="#" onclick="showChartPlot()">Chart</a>
                    </div>
                </li>
            </ul>
        </div>
    </nav>

    
    <!-- Fire Map -->
    <div class="modal fade" id="mapModal" tabindex="-1" role="dialog" aria-labelledby="mapModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mapModalLabel">Wildfires Map</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Embed the map generated by Python directly here -->
                    <iframe src="../map.html" style="width: 100%; height: 400px; border: none;"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Counties Affected -->
    <div class="modal" id="countiesPlotModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Counties Plot</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <img id="countiesPlotImage" src="" alt="Counties Plot">
                </div>
            </div>
        </div>
    </div>

     <!-- Chart generate -->
     <div class="modal" id="chartPlotModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Chart Plot</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <img id="chartPlotImage" src="" alt="chart Plot">
                </div>
            </div>
        </div>
    </div>

    <!--Map content-->
    <div class="centered-map">
        <!--Header text-->
        <p>This is a simple page discuss California wildfire</p>
        <p>Below is the wildfires map</p>

        <!--Map image-->
        <img src="{{ url_for('static', filename='map.png') }}" alt="Wildfires Map">
    </div>


    <!-- Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- JavaScript logic to show map -->
    <script>
        function showMapPopup() {
            $.ajax({
                url: "/get_fire_map",
                type: "GET",
                success: function(data) {
                    $('#mapModal .modal-body').html(data.map_html);
                    $('#mapModal').modal('show');
                },
                error: function(xhr, status, error) {
                    console.error(error);
                }
            });
        }
        function showCountiesPlot() {
            $.ajax({
                url: '/counties_plot',
                type: 'GET',
                success: function(response) {
                    $('#countiesPlotImage').attr('src', 'data:image/png;base64,' + response);
                    $('#countiesPlotModal').modal('show');
                },
                error: function(xhr, status, error) {
                    console.error("Error:", error);
                }
            });
        }

        function showChartPlot() {
            $.ajax({
                url: '/chart_plot',
                type: 'GET',
                success: function(response) {
                    $('#chartPlotImage').attr('src', 'data:image/png;base64,' + response);
                    $('#chartPlotModal').modal('show');
                },
                error: function(xhr, status, error) {
                    console.error("Error:", error);
                }
            });
        }
    </script>
</body>

</html>